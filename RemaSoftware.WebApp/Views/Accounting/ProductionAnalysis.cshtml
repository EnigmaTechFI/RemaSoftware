
@{
    ViewData["Title"] = "Monitoraggio live";
}

<link href="https://app.smplrspace.com/lib/smplr.css" rel="stylesheet" />

<div style="width:100%; height:80vh !important;" id="planimetry">
    
</div>

@section Scripts{
  <script src="../js/demo/smplr.js"></script>
  <script>
    const space = new smplr.Space({
      spaceId: "f76edfb4-4d73-4a2d-9af1-560eccc371f7",
      clientToken: "pub_10506c7898b54e94ac785017766316e4",
      containerId: "planimetry",
    });
    let allMachine = [];
    const macchina1 = [
      {
        id: '47d8c30c-e95c-58b2-b79e-5gdsfgs',
        name: 'Macchina 2',
        number_operators: 1,
        sub_batch: 5,
        operation: 'Pulimentatura',
        tempo: '0:10:34',
        coordinates: [
          {
            levelIndex: 0,
            x: 14,
            z: -5,
            elevation: 0
          },
          {
            levelIndex: 0,
            x: 14,
            z: -8.9,
            elevation: 0
          },
          {
            levelIndex: 0,
            x: 17,
            z: -8.9,
            elevation: 0
          },
          {
            levelIndex: 0,
            x: 17,
            z: -5,
            elevation: 0
          }
        ]
      }
    ]
    const macchina2 = [
      {
        id: '47d8c30c-e95c-58b2-b79e-51b12b6c69c8',
        name: 'Macchina 1',
        number_operators: 2,
        sub_batch: 3,
        operation: 'Smerigliatura',
        tempo: '0:15:32', 
        coordinates: [
          {
            levelIndex: 0,
            x: 14,
            z: 0,
            elevation: 0
          },
          {
            levelIndex: 0,
            x: 14,
            z: -4,
            elevation: 0
          },
          {
            levelIndex: 0,
            x: 17,
            z: -4,
            elevation: 0
          },
          {
            levelIndex: 0,
            x: 17,
            z: 0,
            elevation: 0
          }
        ]
      }
    ]
    const macchina3 = [
      {
        id: '47d8c30c-e95c-58b2-bdf79e-5gdsfgs',
        name: 'Macchina 3',
        number_operators: 1,
        sub_batch: 5,
        operation: 'Pulimentatura',
        tempo: '0:10:34',
        coordinates: [
          {
            levelIndex: 0,
            x: 14,
            z: -10,
            elevation: 0
          },
          {
            levelIndex: 0,
            x: 14,
            z: -13.8,
            elevation: 0
          },
          {
            levelIndex: 0,
            x: 17,
            z: -13.8,
            elevation: 0
          },
          {
            levelIndex: 0,
            x: 17,
            z: -10,
            elevation: 0
          }
        ]
      }
    ]
    
    const macchina4 = [
      {
        id: '47drge8c30c-e95c-58b2-bdf79e-5gdsfgs',
        name: 'Macchina 4',
        number_operators: 1,
        sub_batch: 5,
        operation: 'Pulimentatura',
        tempo: '0:10:34',
        coordinates: [
          {
            levelIndex: 0,
            x: 7,
            z: -1,
            elevation: 0
          },
          {
            levelIndex: 0,
            x: 7,
            z: -3,
            elevation: 0
          },
          {
            levelIndex: 0,
            x: 8,
            z: -3,
            elevation: 0
          },
          {
            levelIndex: 0,
            x: 8,
            z: -1,
            elevation: 0
          }
        ]
      }
    ]
    
    allMachine.push(macchina1)
    allMachine.push(macchina2)
    allMachine.push(macchina3)
    allMachine.push(macchina4)
    
    space.startViewer({
      preview: false,
      loadingMessage: "Prova",
      mode: '3d',
      allowModeChange: true,
      onReady: () => addData(),
    }) 
    
    function addData(){
      allMachine.forEach(function (unit){
        space.addDataLayer({
                id: unit[0].id,
                type: 'polygon',
                data: unit,
                tooltip: 'NÂ° OPERATORI: ' + unit[0].number_operators + ' | OPERAZIONE: ' + unit[0].operation + ' | LOTTO: ' + unit[0].sub_batch + ' | TEMPO: ' + unit[0].tempo,
                color: '#4e73df'
              })
        })
      
    }
    
</script>
}